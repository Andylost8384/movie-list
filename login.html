<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login ‚Äî Infectaria</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<header class="topbar">
  <div class="container">
    <div class="brand">Infectaria</div>
    <nav class="nav">
      <a href="index.html">Home</a>
      <a href="models.html">Models</a>
      <a href="videos.html?category=Hentaied">Hentaied</a>
      <a href="videos.html?category=Lesbian">Lesbian</a>
      <a href="videos.html?category=All">All Sites</a>
      <button id="searchBtn" class="icon">üîç</button>
      <a href="login.html" class="login active">Login</a>
      <a href="profile.html" class="login">Account</a>
      <a href="get-access.html" class="cta">Get Access</a>
    </nav>
  </div>
</header>

<main style="padding-top:110px;">
  <section class="container">

    <h1>Login to your Account</h1>
    <p class="models-subtitle">
      Enter your email and password to continue.
    </p>

    <form class="login-form" id="loginForm">
      <label>
        Email
        <input type="email" id="email" required />
      </label>

      <label>
        Password
        <input type="password" id="password" required />
      </label>

      <button type="submit" class="btn green" id="loginBtn">
        Login
      </button>
    </form>

    <p style="margin-top:12px;">
      <span id="forgotBtn" style="cursor:pointer;color:#0aa;">
        Forgot password?
      </span>
    </p>

    <p style="margin-top:12px;">
      Don‚Äôt have an account?
      <a href="get-access.html" style="color:#0aa;">Sign up</a>
    </p>

    <p id="loginMessage" style="margin-top:14px;color:red;"></p>

  </section>
</main>

<!-- ================= FORGOT PASSWORD MODAL ================= -->
<div id="forgotModal" class="agegate" style="display:none;">
  <div class="agebox">
    <h3>Reset your password</h3>
    <p class="muted">
      Enter your registered email. We will send you a password reset link.
    </p>

    <input
      type="email"
      id="resetEmail"
      placeholder="Your registered email"
      style="width:100%;padding:10px;margin-top:12px;"
    />

    <button id="sendResetBtn" class="btn green" style="margin-top:14px;">
      Send reset link
    </button>

    <button id="closeForgot" class="btn" style="margin-top:10px;">
      Cancel
    </button>

    <p id="resetMessage" style="margin-top:10px;"></p>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="firebase-config.js"></script>

<script>
const auth = firebase.auth();

const loginForm   = document.getElementById("loginForm");
const loginBtn    = document.getElementById("loginBtn");
const loginMsg    = document.getElementById("loginMessage");

const forgotBtn   = document.getElementById("forgotBtn");
const forgotModal = document.getElementById("forgotModal");
const closeForgot = document.getElementById("closeForgot");
const sendReset   = document.getElementById("sendResetBtn");
const resetMsg    = document.getElementById("resetMessage");

/* ================= LOGIN ================= */
loginForm.addEventListener("submit", (e) => {
  e.preventDefault();

  loginMsg.textContent = "";
  loginBtn.disabled = true;
  loginBtn.textContent = "Logging in...";

  const email = emailInput();
  const pass  = passwordInput();

  auth.signInWithEmailAndPassword(email, pass)
    .then(() => {
      window.location.href = "profile.html";
    })
    .catch((err) => {

      // REAL ERROR HANDLING
      if (err.code === "auth/user-not-found") {
        loginMsg.textContent =
          "This email is not registered. Please sign up.";
      }
      else if (err.code === "auth/wrong-password") {
        loginMsg.textContent =
          "Incorrect password. Please try again.";
      }
      else {
        loginMsg.textContent = err.message;
      }

      loginBtn.disabled = false;
      loginBtn.textContent = "Login";
    });
});

function emailInput() {
  return document.getElementById("email").value.trim();
}
function passwordInput() {
  return document.getElementById("password").value;
}

/* ================= FORGOT PASSWORD ================= */
forgotBtn.addEventListener("click", () => {
  resetMsg.textContent = "";
  forgotModal.style.display = "flex";
});

closeForgot.addEventListener("click", () => {
  forgotModal.style.display = "none";
});

sendReset.addEventListener("click", () => {
  const email = document.getElementById("resetEmail").value.trim();

  if (!email) {
    resetMsg.style.color = "red";
    resetMsg.textContent = "Please enter your email.";
    return;
  }

  sendReset.disabled = true;
  sendReset.textContent = "Sending...";

  auth.sendPasswordResetEmail(email)
    .then(() => {
      resetMsg.style.color = "green";
      resetMsg.textContent =
        "Password reset link sent. Check your email.";
      sendReset.disabled = false;
      sendReset.textContent = "Send reset link";
    })
    .catch((err) => {

      if (err.code === "auth/user-not-found") {
        resetMsg.style.color = "red";
        resetMsg.textContent =
          "This email is not registered.";
      } else {
        resetMsg.textContent = err.message;
      }

      sendReset.disabled = false;
      sendReset.textContent = "Send reset link";
    });
});
</script>

<script src="search.js"></script>
<script src="script.js"></script>
</body>
</html>
